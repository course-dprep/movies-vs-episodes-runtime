---
title: "Deliverable4"
output: html_document
date: "2025-09-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

## Movie vs TV Episode Runtime and Audience Ratings Analysis

# Step 0: Setup

```{r}
library(tidyverse)
```

# Step 1: Load raw data directly from IMDb URLs & read IMDb datasets

```{r}
title_url <- "https://datasets.imdbws.com/title.basics.tsv.gz"
rating_url <- "https://datasets.imdbws.com/title.ratings.tsv.gz"

title_basics_raw <- read_tsv(title_url, na = c("\\N", ""), show_col_types = FALSE)
ratings_raw <- read_tsv(rating_url, na = c("\\N", ""), show_col_types = FALSE)
```

# Step 2: Filter only movies and TV episodes 

```{r, cache=TRUE}
filtered_movies_TVepisodes <- title_basics_raw %>% 
  filter(titleType %in% c("movie", "tvEpisode"))
```

# Step 3: Merge with ratings'

```{r, cache=TRUE}
merged_data <- filtered_movies_TVepisodes %>% 
  left_join(ratings_raw, by = "tconst")

cat("Number of unmatched rows:", nrow(filtered_movies_TVepisodes)-nrow(merged_data), "\n")
```

# Step 4: Create dummy variable for TV episodes

```{r}
merged_data <- merged_data %>% 
  mutate(is_tvepisode = ifelse(titleType == "tvEpisode", 1,0))
```

# Step 5: Select relevant columns, remove missing values, de-deplicate

```{r, cache=TRUE}
library(data.table)
analysis_data <- as.data.table(merged_data)
analysis_data[, c("originalTitle", "titleType", "isAdult", "endYear", "genres", "numVotes") := NULL] 
analysis_data <- analysis_data[!is.na(runtimeMinutes) & !is.na(averageRating) & !is.na(startYear)] %>% distinct(tconst, .keep_all = TRUE)
 
```

# Step 6: Remove extreme outliers for runtime

```{r}
library(ggplot2)

ggplot(analysis_data, aes(y = runtimeMinutes)) +
  geom_boxplot(fill = "blue", outlier.color = "red", outlier.shape = 16) +
  labs(
    y = "Runtime (minutes)",
    title = "Boxplot of Movie and TV Episode Runtime with Outliers Highlighted"
  ) +
  theme_minimal()


# Function to remove outliers by group
analysis_data_clean <- analysis_data %>%
  group_by(is_tvepisode) %>%
  filter({
    Q1 <- quantile(runtimeMinutes, 0.25)
    Q3 <- quantile(runtimeMinutes, 0.75)
    IQR_val <- Q3 - Q1
    runtimeMinutes >= (Q1 - 1.5 * IQR_val) & runtimeMinutes <= (Q3 + 1.5 * IQR_val)
  }) %>%
  ungroup()

ggplot(analysis_data_clean, aes(y = runtimeMinutes)) +
  geom_boxplot(fill = "green") +
  labs(
    y = "Runtime (minutes)",
    title = "Boxplot of Movie and TV Episode Runtime (Outliers Removed)"
  ) +
  theme_minimal()

```

# Step 7: Check the cleaned data

```{r}
dim(analysis_data_clean)

analysis_data_clean %>%
  group_by(is_tvepisode) %>%
  group_split() %>%
  lapply(function(df) {
    summary(df$runtimeMinutes)
  })


summary(analysis_data_clean$averageRating)
```

```{r}
# Plot after removing outliers per group
ggplot(analysis_data_clean, aes(x = factor(is_tvepisode, labels = c("Movie", "TV Episode")),
                                y = runtimeMinutes,
                                fill = factor(is_tvepisode, labels = c("Movie", "TV Episode")))) +
  geom_boxplot(outlier.color = "red", outlier.shape = 16) +
  labs(
    x = "Type",
    y = "Runtime (minutes)",
    fill = "Type",
    title = "Runtime Distribution by Type (Outliers Removed)"
  ) +
  theme_minimal()


table(analysis_data_clean$is_tvepisode)
```

# Step 8: Remove outliers for runtime series

```{r}
# Analysing the data

analysis_data_clean %>%
  filter(is_tvepisode == 1) %>%
  ggplot(aes(x = runtimeMinutes)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black") +
  labs(title = "Distribution of Runtime for TV Episodes",
       x = "Runtime (minutes)",
       y = "Count")

analysis_data_clean %>%
   filter(runtimeMinutes < 15, is_tvepisode==1) %>%
   summarise(count = n())
  
  # Removing TV episodes that are shorter than 15 minutes or longer than 65 minutes
  
  analysis_data_clean <- analysis_data_clean %>%
  filter(is_tvepisode != 1 | (runtimeMinutes >= 15 & runtimeMinutes <= 65))


```


